name: Setup Progress Tracker
on:
  push:
    paths: 
      - 'setup/ONBOARDING-CHECKLIST.md'
      - 'README.md'
  workflow_dispatch: # Allows manual triggering

permissions:
  contents: write
  issues: write

jobs:
  track_progress:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Check setup progress
        id: check-progress
        run: |
          if [ -f "setup/ONBOARDING-CHECKLIST.md" ]; then
            COMPLETED=$(grep -c '\[x\]' setup/ONBOARDING-CHECKLIST.md || echo "0")
            TOTAL=$(grep -c '\[ \]\|\[x\]' setup/ONBOARDING-CHECKLIST.md || echo "1")
          else
            COMPLETED=0
            TOTAL=1
          fi
          
          echo "completed=$COMPLETED" >> $GITHUB_OUTPUT
          echo "total=$TOTAL" >> $GITHUB_OUTPUT
          echo "âœ… Setup Progress: $COMPLETED/$TOTAL tasks completed"
          
      - name: Celebrate progress
        if: steps.check-progress.outputs.completed >= 1
        run: |
          echo "ðŸŽ‰ Great job! You've completed ${{ steps.check-progress.outputs.completed }} setup task(s)!"
          
      - name: Add completion badge
        if: steps.check-progress.outputs.completed >= 4
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // Check if completion issue already exists
            const { data: issues } = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: "all",
              labels: "completed"
            });
            
            const completionIssueExists = issues.length > 0;
            
            if (!completionIssueExists) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: "ðŸŽ‰ Setup Complete - You're Ready!",
                labels: ["completed", "celebration"],
                body: `## ðŸŽ‰ Congratulations!

**You've successfully completed your DESN368 toolkit setup!**

### âœ… **What You've Accomplished:**
- GitHub portfolio repository created and configured
- Figma account set up for design work
- CodePen account ready for code experiments  
- FreeCodeCamp profile configured for learning

### ðŸš€ **Next Steps:**
1. **Submit your Canvas assignment** with your GitHub repository URL
2. **Start Week 1 assignments** in the \`week01/\` folder
3. **Begin building your portfolio** with your first projects

### ðŸŒŸ **Pro Tips:**
- **Commit regularly** to track your progress
- **Use meaningful commit messages** like "Add Week 1 HTML project"
- **Keep your README updated** as you complete assignments

**You're now ready to dive into web design! Close this issue and start creating! ðŸš€**`
              });
              console.log("ðŸŽ‰ Completion celebration issue created!");
            }
